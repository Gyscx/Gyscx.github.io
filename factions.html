<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>派系 | Shadow Fight 3 中文 Wiki</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>

<body class="theme-accent"><!-- 可选：派系主题 -->
    <!-- 登录模态框 -->
    <div id="loginModal" class="login-modal" style="display: none;">
        <div class="login-box">
            <h2>请先登录</h2>
            <p>您需要登录才能访问此页面</p>

            <div class="input-group">
                <label for="loginUsername">用户名</label>
                <input type="text" id="loginUsername" placeholder="请输入用户名">
            </div>

            <div class="input-group">
                <label for="loginPassword">密码</label>
                <input type="password" id="loginPassword" placeholder="请输入密码">
            </div>

            <div class="login-buttons">
                <button id="performLogin" class="login-btn">登录</button>
                <button id="goToRegister" class="register-btn">注册账号</button>
            </div>
        </div>
    </div>
    <header class="top">
        <div class="logo"><img src="./Logo.png" alt="暗影格斗3" height="50"> </div>
        <nav>
            <a href="index.html">首页</a>
            <a href="factions.html">派系</a>
            <a href="guides.html">攻略</a>
            <a href="codex.html">图鉴</a>
            <a href="story.html">剧情</a>
            <a href="http://192.168.1.10:3000/login.html" class="login_display" id="loginDisplay"><span
                    style="color: red;">登录</span></a>
        </nav>

        <!-- 用户信息区域 -->
        <div class="user-info" id="userInfo" style="display: none;">
            欢迎， <span id="usernameDisplay"></span>
            <button id="logoutBtn" class="logout-btn">退出登录</button>
        </div>
    </header>

    <main class="container">

        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="index.html">首页</a>
            <span class="sep">›</span>
            派系
        </nav>

        <!-- 页面内容从这里开始 -->
        <h1>派系</h1>
        <div>
            <img src="./Legion.png" alt="军团" class="responsive-img2"><img src="./Dynasty.png" alt="王朝"
                class="responsive-img2"><img src="./Heralds.png" alt="先锋" class="responsive-img2">
        </div>
        <div class="grid">
            <a class="card" href="faction_legion.html">
                <h3>军团</h3>
                <p>纪律 · 防守反击</p>
            </a>
            <a class="card" href="faction_dynasty.html">
                <h3>王朝</h3>
                <p>高速 · 连击压制</p>
            </a>
            <a class="card" href="faction_herald.html">
                <h3>先锋</h3>
                <p>机制 · 高风险爆发</p>
            </a>
        </div>
    </main>

    <footer>
        本站为 Shadow Fight 3 非官方中文 Wiki，与 Nekki/万达院线游戏(互爱互动) 无隶属关系。
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DOM元素
            const loginModal = document.getElementById('loginModal');
            const userInfo = document.getElementById('userInfo');
            const usernameDisplay = document.getElementById('usernameDisplay');
            const logoutBtn = document.getElementById('logoutBtn');
            const performLogin = document.getElementById('performLogin');
            const goToRegister = document.getElementById('goToRegister');
            const loginDisplay = document.getElementById('loginDisplay');

            // 检查登录状态
            function checkLoginStatus() {
                const token = localStorage.getItem('token');
                const username = localStorage.getItem('username');

                if (token && username) {
                    // 已登录
                    usernameDisplay.textContent = username;
                    userInfo.style.display = 'flex';
                    loginModal.style.display = 'none';
                    loginDisplay.style.display = 'none';
                } else {
                    // 未登录
                    userInfo.style.display = 'none';
                    loginDisplay.style.display = 'inline';
                }
            }

            // 模拟登录函数
            function login(username, password) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (username && password) {
                            resolve({
                                token: 'mock_token_' + Date.now(),
                                username: username,
                                role: 'user'
                            });
                        } else {
                            reject(new Error('用户名或密码不能为空'));
                        }
                    }, 1000);
                });
            }

            // 登录按钮点击事件
            performLogin.addEventListener('click', async function () {
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;

                if (!username || !password) {
                    alert('请输入用户名和密码');
                    return;
                }

                performLogin.textContent = '登录中...';
                performLogin.disabled = true;

                try {
                    const result = await login(username, password);

                    localStorage.setItem('token', result.token);
                    localStorage.setItem('username', result.username);
                    localStorage.setItem('role', result.role);

                    checkLoginStatus();

                    const targetPage = localStorage.getItem('targetPage');
                    if (targetPage) {
                        localStorage.removeItem('targetPage');
                        window.location.href = targetPage;
                    } else {
                        window.location.href = 'index.html';
                    }
                } catch (error) {
                    alert('登录失败: ' + error.message);
                    performLogin.textContent = '登录';
                    performLogin.disabled = false;
                }
            });

            // 注册按钮点击事件
            goToRegister.addEventListener('click', function () {
                window.location.href = 'register.html';
            });

            // 退出登录
            logoutBtn.addEventListener('click', function () {
                if (confirm('确定要退出登录吗？')) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('username');
                    localStorage.removeItem('role');
                    checkLoginStatus();
                }
            });

            // 页面加载时检查登录状态
            checkLoginStatus();
        });
    </script>
</body>

</html>